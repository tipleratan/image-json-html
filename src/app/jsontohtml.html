<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Form Generator</title>
    <!-- Load Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for a cleaner form look */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
        }

        .form-container {
            transition: all 0.5s ease-in-out;
        }

        .form-header-title {
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        /* Style for the custom file input button */
        .file-upload-label {
            display: inline-block;
            cursor: pointer;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            background-color: #4f46e5;
            color: white;
            font-weight: 600;
            transition: background-color 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }

        .file-upload-label:hover {
            background-color: #4338ca;
        }

        #jsonFileInput {
            display: none;
            /* Hide the default file input */
        }
    </style>
</head>

<body class="p-4 md:p-8 min-h-screen flex flex-col items-center">

    <!-- Upload Interface -->
    <div id="uploadInterface"
        class="w-full max-w-xl bg-white p-8 rounded-xl shadow-2xl transition duration-500 ease-in-out">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Dynamic Form Builder</h1>
        <p class="text-gray-600 mb-6">Upload a JSON template to instantly generate an editable HTML form.</p>

        <input type="file" id="jsonFileInput" accept="application/json" onchange="handleFileUpload(event)">
        <label for="jsonFileInput" class="file-upload-label">
            <svg class="w-5 h-5 inline mr-2 -mt-0.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
            </svg>
            Select JSON File
        </label>
        <div id="uploadMessage" class="mt-4 text-sm text-gray-500"></div>
    </div>

    <!-- Generated Form Display Area -->
    <div id="formDisplay"
        class="form-container w-full max-w-4xl bg-white p-8 md:p-12 mt-8 rounded-xl shadow-2xl border border-gray-100 hidden">
        <form id="dynamicForm" class="space-y-6"></form>
        <div class="mt-10 pt-6 border-t border-gray-200">
            <button onclick="saveFormData()"
                class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition duration-150 ease-in-out shadow-md hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50">
                Submit & Log Data to Console
            </button>
        </div>
    </div>

    <!-- Message Modal Area (Custom replacement for alert/confirm) -->
    <div id="messageModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
            <h3 id="modalTitle" class="text-xl font-semibold text-gray-900 mb-4"></h3>
            <p id="modalBody" class="text-gray-700 mb-6"></p>
            <button onclick="document.getElementById('messageModal').classList.add('hidden')"
                class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 rounded-lg transition duration-150">Close</button>
        </div>
    </div>

    <script>
        // Global utility to show custom modal (since alert() is forbidden)
        function showMessage(title, body)
        {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').textContent = body;
            document.getElementById('messageModal').classList.remove('hidden');
        }

        /**
         * Converts a camelCase or snake_case string to Title Case for display in labels.
         * e.g., 'date_of_birth' -> 'Date Of Birth'
         * @param {string} str The string to format.
         * @returns {string} The formatted string.
         */
        function formatLabel(str)
        {
            if (!str) return '';
            return str
                .replace(/([A-Z])/g, ' $1') // Add space before capital letters
                .replace(/_/g, ' ')         // Replace underscores with spaces
                .toLowerCase()              // Ensure all lower case for proper capitalization
                .split(' ')                 // Split into words
                .map(word => word.charAt(0).toUpperCase() + word.slice(1)) // Capitalize each word
                .join(' ')
                .trim();
        }

        /**
         * Determines the appropriate HTML input type based on the field key.
         * @param {string} key The field key (e.g., 'email', 'phone', 'date_of_birth').
         * @returns {string} The HTML input type (e.g., 'email', 'tel', 'date', 'text').
         */
        function determineInputType(key)
        {
            const lowerKey = key.toLowerCase();
            if (lowerKey.includes('date')) return 'date';
            if (lowerKey.includes('email')) return 'email';
            if (lowerKey.includes('phone') || lowerKey.includes('contact')) return 'tel';
            if (lowerKey.includes('postal_code') || lowerKey.includes('zip')) return 'number';
            if (lowerKey.includes('address')) return 'textarea';
            return 'text';
        }

        /**
         * Main function to handle the JSON file upload and kick off form generation.
         * @param {Event} event The file change event.
         */
        function handleFileUpload(event)
        {
            const file = event.target.files[0];
            const messageEl = document.getElementById('uploadMessage');

            if (!file)
            {
                messageEl.textContent = 'No file selected.';
                return;
            }

            if (file.type !== 'application/json')
            {
                showMessage('Invalid File Type', 'Please upload a valid JSON file.');
                messageEl.textContent = 'Invalid file type.';
                return;
            }

            messageEl.textContent = `Processing file: ${file.name}...`;

            const reader = new FileReader();
            reader.onload = (e) =>
            {
                try
                {
                    const jsonData = JSON.parse(e.target.result);
                    generateForm(jsonData);

                    // Hide upload interface and show form
                    document.getElementById('uploadInterface').classList.add('hidden');
                    document.getElementById('formDisplay').classList.remove('hidden');
                    messageEl.textContent = 'Form generated successfully!';
                } catch (error)
                {
                    console.error("Error parsing JSON:", error);
                    showMessage('JSON Parsing Error', 'Failed to parse the JSON file. Please ensure it is well-formed.');
                    messageEl.textContent = 'Error processing file.';
                    // Re-show upload interface on error
                    document.getElementById('uploadInterface').classList.remove('hidden');
                    document.getElementById('formDisplay').classList.add('hidden');
                }
            };
            reader.onerror = (e) =>
            {
                console.error("File reading error:", e);
                showMessage('File Reading Error', 'There was an issue reading the file.');
                messageEl.textContent = 'Error reading file.';
            };
            reader.readAsText(file);
        }

        /**
         * Dynamically generates the HTML form based on the parsed JSON data.
         * @param {Object} jsonData The parsed JSON object.
         */
        function generateForm(jsonData)
        {
            const formEl = document.getElementById('dynamicForm');
            formEl.innerHTML = ''; // Clear previous form content

            // 1. Handle Form Details (Header)
            if (jsonData.form_details)
            {
                const details = jsonData.form_details;
                const headerHtml = `
                    <div class="text-center mb-10 border-b pb-4 border-indigo-200">
                        <h1 class="text-3xl font-extrabold form-header-title text-indigo-700">${details.academy_name || 'ACADEMY NAME'}</h1>
                        <p class="text-lg font-semibold text-indigo-500">${details.academy_type || 'FORM'}</p>
                        <p class="text-sm italic text-gray-500 mt-1">${details.academy_slogan || ''}</p>
                        ${Array.isArray(details.form_type) ?
                        `<div class="mt-4"><label class="text-sm font-medium text-gray-700">Form Type:</label>
                            <select id="form_type" name="form_type" class="ml-2 p-2 border border-gray-300 rounded-lg bg-gray-50 focus:ring-indigo-500 focus:border-indigo-500">
                                ${details.form_type.map(type => `<option value="${type}">${type}</option>`).join('')}
                            </select></div>` : ''
                    }
                    </div>
                `;
                formEl.insertAdjacentHTML('beforeend', headerHtml);
            }

            // 2. Iterate through all other sections (except form_details)
            for (const sectionKey in jsonData)
            {
                if (sectionKey === 'form_details') continue;

                const sectionData = jsonData[sectionKey];
                const sectionTitle = formatLabel(sectionKey);

                // Create Section Header
                const sectionEl = document.createElement('div');
                sectionEl.className = 'mb-8';
                sectionEl.innerHTML = `
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4 border-l-4 border-indigo-500 pl-3 pt-1 pb-1 bg-indigo-50 rounded-tr-md">${sectionTitle}</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="${sectionKey}-fields"></div>
                `;
                formEl.appendChild(sectionEl);

                const fieldsContainer = sectionEl.querySelector(`#${sectionKey}-fields`);

                for (const fieldKey in sectionData)
                {
                    const fieldValue = sectionData[fieldKey];
                    const labelText = formatLabel(fieldKey);
                    const inputId = fieldKey;

                    // Helper for creating form groups
                    const createFormGroup = (inputHtml, cols = 'md:col-span-1') => `
                        <div class="relative ${cols}">
                            <label for="${inputId}" class="block text-sm font-medium text-gray-700 mb-1">${labelText}</label>
                            ${inputHtml}
                        </div>
                    `;

                    let inputHtml = '';
                    let colSpan = 'md:col-span-1';

                    // Determine Field Type based on value/key
                    if (Array.isArray(fieldValue))
                    {
                        // Dropdown/Select for array options
                        inputHtml = `
                            <select id="${inputId}" name="${inputId}" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-lg shadow-sm">
                                ${fieldValue.map(option => `<option value="${option}">${option}</option>`).join('')}
                            </select>
                        `;
                    } else if (typeof fieldValue === 'string' && fieldValue.includes('( Signature Here )'))
                    {
                        // Signature Placeholder/Field
                        colSpan = 'md:col-span-1';
                        inputHtml = `
                            <div class="mt-1 p-8 text-center border-2 border-dashed border-gray-300 bg-gray-50 rounded-lg text-sm italic text-gray-500 h-24 flex items-center justify-center">
                                ${fieldValue}
                            </div>
                        `;
                        // Change label for signature fields
                        fieldsContainer.insertAdjacentHTML('beforeend', createFormGroup(inputHtml, colSpan));
                        continue; // Skip standard append
                    } else
                    {
                        const inputType = determineInputType(fieldKey);

                        if (inputType === 'textarea' || fieldKey === 'present_address')
                        {
                            // Textarea for addresses
                            colSpan = 'md:col-span-2';
                            inputHtml = `
                                <textarea id="${inputId}" name="${inputId}" rows="3" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter your full address"></textarea>
                            `;
                        } else
                        {
                            // Standard input (text, date, email, tel, number)
                            colSpan = 'md:col-span-1';
                            // Special handling for phone to include pattern for better touch keyboard on mobile
                            const pattern = inputType === 'tel' ? 'pattern="[0-9]*"' : '';
                            inputHtml = `
                                <input type="${inputType}" id="${inputId}" name="${inputId}" ${pattern}
                                    class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
                                    placeholder="Enter your ${labelText.toLowerCase()}"
                                >
                            `;
                        }
                    }

                    fieldsContainer.insertAdjacentHTML('beforeend', createFormGroup(inputHtml, colSpan));
                }
            }
        }

        /**
         * Captures the current form data and logs it to the console (simulating submission).
         */
        function saveFormData()
        {
            const form = document.getElementById('dynamicForm');
            const formData = new FormData(form);
            const data = {};

            // Convert FormData to a structured object
            for (const [key, value] of formData.entries())
            {
                data[key] = value;
            }

            console.log("--- Form Data Captured ---");
            console.log(data);
            console.log("--------------------------");

            showMessage('Submission Logged', 'The form data has been successfully captured and logged to the browser console for inspection. In a real Angular application, this data would now be sent to a backend API for persistence.');
        }

    </script>
</body>

</html>